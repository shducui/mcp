# AI Chat Bubble - æ™ºèƒ½æ‚¬æµ®çƒèŠå¤©ç»„ä»¶

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„AIèŠå¤©æ‚¬æµ®çƒç»„ä»¶ï¼Œæ”¯æŒæµå¼è¯­éŸ³è¾“å…¥ã€å®æ—¶æ–‡æœ¬æ˜¾ç¤ºã€è¯­éŸ³åˆæˆæ’­æŠ¥ç­‰é«˜çº§åŠŸèƒ½ã€‚

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### ğŸ¤ æµå¼è¯­éŸ³è¯†åˆ«
- **å®æ—¶æ–‡æœ¬æ˜¾ç¤º**ï¼šç”¨æˆ·è¯´è¯æ—¶æ–‡å­—å®æ—¶å‡ºç°åœ¨è¾“å…¥æ¡†ä¸­
- **3ç§’æ™ºèƒ½é™é»˜æ£€æµ‹**ï¼šåœæ­¢è¯´è¯3ç§’åè‡ªåŠ¨å‘é€æ¶ˆæ¯ç»™AI
- **æŒä¹…åŒ–å½•éŸ³æ¨¡å¼**ï¼šä¸€é”®å¼€å¯è¿ç»­è¯­éŸ³äº¤äº’ï¼Œæ— éœ€é‡å¤ç‚¹å‡»
- **å¢é‡æ–‡æœ¬å¤„ç†**ï¼šé¿å…é‡å¤å‘é€ï¼Œç¡®ä¿æ¯æ¬¡åªå‘é€æ–°å†…å®¹

### ğŸ¯ æ™ºèƒ½è¯­éŸ³æŒ‡ä»¤
æ”¯æŒæœ¬åœ°å¤„ç†çš„è¯­éŸ³æŒ‡ä»¤ï¼Œæ— éœ€å‘é€ç»™AIï¼š
- `"æ¸…ç©º"/"æ¸…é™¤"` - æ¸…ç©ºå¯¹è¯å†å²
- `"å‘é€"` - ç«‹å³å‘é€å½“å‰è¾“å…¥å†…å®¹
- `"åœæ­¢æ’­æŠ¥"` - åœæ­¢è¯­éŸ³æ’­æŠ¥
- `"æœ—è¯»å…³é—­/å¼€å¯"` - æ§åˆ¶TTSå¼€å…³
- `"ç»“æŸå¯¹è¯"` - é€€å‡ºæŒä¹…åŒ–å½•éŸ³æ¨¡å¼

### ğŸ”Š è¯­éŸ³åˆæˆæ’­æŠ¥ (TTS)
- **è¿ç»­æ’­æŠ¥æ¨¡å¼**ï¼šæ‰€æœ‰AIå›å¤è‡ªåŠ¨è¯­éŸ³æ’­æŠ¥
- **å•æ¬¡æ’­æŠ¥æ¨¡å¼**ï¼šä»…åœ¨æ˜ç¡®è¦æ±‚æ—¶æ’­æŠ¥
- **å¿«é€Ÿè¯­é€Ÿè®¾ç½®**ï¼š1.5å€é€Ÿæ’­æŠ¥ï¼Œæå‡äº¤äº’æ•ˆç‡
- **æ’­æŠ¥æ§åˆ¶**ï¼šéšæ—¶åœæ­¢æˆ–åˆ‡æ¢æ’­æŠ¥æ¨¡å¼

### ğŸ’¾ æ•°æ®æŒä¹…åŒ–
- **å¯¹è¯å†å²ä¿å­˜**ï¼š24å°æ—¶å†…è‡ªåŠ¨æ¢å¤å¯¹è¯è®°å½•
- **çŠ¶æ€è®°å¿†**ï¼šè®°ä½è¯­éŸ³æ¨¡å¼ã€å¯¹è¯æ¡†çŠ¶æ€ã€éº¦å…‹é£è®¾ç½®
- **ä½ç½®è®°å¿†**ï¼šæ‚¬æµ®çƒä½ç½®è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤
- **è¿‡æœŸæ¸…ç†**ï¼šè¶…è¿‡24å°æ—¶è‡ªåŠ¨æ¸…ç†æ•°æ®

### ğŸ›  æ™ºèƒ½å·¥å…·è°ƒç”¨
- **é¡µé¢å¯¼èˆª**ï¼š`navigateToPage` - æ™ºèƒ½é¡µé¢è·³è½¬
- **å›¾ç‰‡æ“ä½œ**ï¼š`zoomInOnPhoto`/`zoomOutPhoto` - å›¾ç‰‡æ”¾å¤§ç¼©å°
- **è¯­éŸ³æ§åˆ¶**ï¼š`toggleSpeechMode`/`speakOnce`/`stopSpeech` - è¯­éŸ³æ¨¡å¼æ§åˆ¶

## ğŸ— æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ
- **Vue 3** + **Composition API** - ç°ä»£å“åº”å¼æ¡†æ¶
- **TypeScript** - ç±»å‹å®‰å…¨å¼€å‘
- **Vite** - é«˜æ€§èƒ½æ„å»ºå·¥å…·
- **Web Speech API** - æµè§ˆå™¨åŸç”Ÿè¯­éŸ³è¯†åˆ«
- **Speech Synthesis API** - æµè§ˆå™¨åŸç”Ÿè¯­éŸ³åˆæˆ

### AIé›†æˆ
- **@ai-sdk/vue** - AI SDK Vueé›†æˆ
- **æµå¼å“åº”å¤„ç†** - å®æ—¶AIå¯¹è¯ä½“éªŒ
- **å·¥å…·è°ƒç”¨æ”¯æŒ** - æ‰©å±•AIåŠŸèƒ½è¾¹ç•Œ

### æ ¸å¿ƒç»„ä»¶ç»“æ„
```
src/
â”œâ”€â”€ AiChatBubble.vue          # ä¸»ç»„ä»¶ - UIç•Œé¢å’Œäº¤äº’é€»è¾‘
â”œâ”€â”€ entry.ts                  # Web Componentå…¥å£æ–‡ä»¶
â””â”€â”€ composables/
    â””â”€â”€ useAudioRecorder.ts   # è¯­éŸ³è¯†åˆ«é€»è¾‘å°è£…
```

### å…³é”®æŠ€æœ¯å®ç°

#### 1. æµå¼è¯­éŸ³è¯†åˆ« (`useAudioRecorder.ts`)
```typescript
// åŒå›è°ƒæ¶æ„
useAudioRecorder(
  // å®Œæˆè¯†åˆ«å›è°ƒï¼ˆ3ç§’é™é»˜åï¼‰
  (finalText: string) => { /* å¤„ç†æœ€ç»ˆæ–‡æœ¬ */ },
  // æµå¼æ›´æ–°å›è°ƒï¼ˆå®æ—¶æ˜¾ç¤ºï¼‰
  (streamingText: string) => { /* å®æ—¶æ›´æ–°UI */ }
)
```

#### 2. é™é»˜æ£€æµ‹æœºåˆ¶
```typescript
const resetSilenceTimer = () => {
  if (silenceTimer) clearTimeout(silenceTimer);
  silenceTimer = setTimeout(() => {
    // 3ç§’åè‡ªåŠ¨å‘é€
    onTranscriptionComplete(finalText);
  }, 3000);
};
```

#### 3. å¢é‡æ–‡æœ¬å¤„ç†
```typescript
// é¿å…é‡å¤å‘é€çš„å…³é”®é€»è¾‘
let lastFinalResultIndex = 0;
let lastKnownFinalCount = 0;

// åªå¤„ç†æ–°çš„æœ€ç»ˆç»“æœ
if (i >= lastFinalResultIndex) {
  newFinalSegments += res[0].transcript;
}
```

## ğŸ“¦ éƒ¨ç½²é›†æˆæŒ‡å—

### 1. ä½œä¸ºç‹¬ç«‹Web Componentéƒ¨ç½²

#### æ„å»ºWeb Component
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd my-ai-app

# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºWeb Component
npx vite build --config vite.lib.config.ts
```

#### åœ¨ä»»æ„ç½‘ç«™ä¸­ä½¿ç”¨
```html
<!DOCTYPE html>
<html>
<head>
  <title>My Website</title>
</head>
<body>
  <!-- ä½ çš„ç½‘ç«™å†…å®¹ -->
  
  <!-- å¼•å…¥AIæ‚¬æµ®çƒ -->
  <script type="module" src="./dist/ai-chat-bubble.es.js"></script>
  
  <!-- ä½¿ç”¨ç»„ä»¶ -->
  <ai-chat-bubble api-url="https://your-api.com/chat"></ai-chat-bubble>
</body>
</html>
```

### 2. Vue 3é¡¹ç›®é›†æˆ

#### å®‰è£…ä¾èµ–
```bash
npm install @ai-sdk/vue
```

#### å¤åˆ¶æ ¸å¿ƒæ–‡ä»¶
```bash
# å¤åˆ¶ç»„ä»¶æ–‡ä»¶åˆ°ä½ çš„é¡¹ç›®
cp src/AiChatBubble.vue your-project/src/components/
cp composables/useAudioRecorder.ts your-project/src/composables/
```

#### åœ¨Vueé¡¹ç›®ä¸­ä½¿ç”¨
```vue
<template>
  <div>
    <!-- ä½ çš„åº”ç”¨å†…å®¹ -->
    
    <!-- AIæ‚¬æµ®çƒ -->
    <AiChatBubble :api-url="apiUrl" />
  </div>
</template>

<script setup>
import AiChatBubble from '@/components/AiChatBubble.vue'

const apiUrl = 'https://your-api.com/chat'
</script>
```

### 3. Nuxt 3é¡¹ç›®é›†æˆ

#### å®‰è£…ä¾èµ–
```bash
npm install @ai-sdk/vue
```

#### é…ç½®nuxt.config.ts
```typescript
export default defineNuxtConfig({
  // å…¶ä»–é…ç½®...
  
  ssr: false, // å¦‚æœä½¿ç”¨è¯­éŸ³åŠŸèƒ½ï¼Œå»ºè®®å…³é—­SSR
  
  css: [
    // å¦‚æœéœ€è¦å…¨å±€æ ·å¼
  ],
  
  vite: {
    optimizeDeps: {
      include: ['@ai-sdk/vue']
    }
  }
})
```

#### åˆ›å»ºæ’ä»¶æ–‡ä»¶
```typescript
// plugins/ai-chat-bubble.client.ts
import AiChatBubble from '~/components/AiChatBubble.vue'

export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.component('AiChatBubble', AiChatBubble)
})
```

#### åœ¨é¡µé¢ä¸­ä½¿ç”¨
```vue
<template>
  <div>
    <!-- ä½ çš„é¡µé¢å†…å®¹ -->
    
    <!-- AIæ‚¬æµ®çƒ - ä»…åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ -->
    <ClientOnly>
      <AiChatBubble :api-url="apiUrl" />
    </ClientOnly>
  </div>
</template>

<script setup>
const apiUrl = useRuntimeConfig().public.aiApiUrl
</script>
```

### 4. Reacté¡¹ç›®é›†æˆ

#### å®‰è£…ä¾èµ–
```bash
npm install @ai-sdk/react
```

#### åˆ›å»ºReactåŒ…è£…ç»„ä»¶
```tsx
// components/AiChatBubbleWrapper.tsx
import { useEffect, useRef } from 'react';

interface AiChatBubbleProps {
  apiUrl: string;
}

export default function AiChatBubbleWrapper({ apiUrl }: AiChatBubbleProps) {
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    // åŠ¨æ€åŠ è½½Web Component
    const script = document.createElement('script');
    script.type = 'module';
    script.src = '/dist/ai-chat-bubble.es.js';
    document.head.appendChild(script);

    return () => {
      document.head.removeChild(script);
    };
  }, []);

  useEffect(() => {
    if (containerRef.current) {
      const element = document.createElement('ai-chat-bubble');
      element.setAttribute('api-url', apiUrl);
      containerRef.current.appendChild(element);

      return () => {
        if (containerRef.current) {
          containerRef.current.innerHTML = '';
        }
      };
    }
  }, [apiUrl]);

  return <div ref={containerRef}></div>;
}
```

#### åœ¨Reactåº”ç”¨ä¸­ä½¿ç”¨
```tsx
// App.tsx
import AiChatBubbleWrapper from './components/AiChatBubbleWrapper';

function App() {
  return (
    <div className="App">
      {/* ä½ çš„åº”ç”¨å†…å®¹ */}
      
      {/* AIæ‚¬æµ®çƒ */}
      <AiChatBubbleWrapper apiUrl="https://your-api.com/chat" />
    </div>
  );
}

export default App;
```

## ğŸ”§ é…ç½®é€‰é¡¹

### APIæ¥å£è¦æ±‚
```typescript
// POST /chat
{
  "messages": [
    {
      "role": "user",
      "content": "ç”¨æˆ·æ¶ˆæ¯"
    }
  ]
}

// å“åº”æ ¼å¼
{
  "choices": [
    {
      "message": {
        "role": "assistant",
        "content": "AIå›å¤",
        "tool_calls": [
          // å¯é€‰çš„å·¥å…·è°ƒç”¨
        ]
      }
    }
  ]
}
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# .env
NUXT_PUBLIC_AI_API_URL=https://your-api.com/chat
```

### æµè§ˆå™¨å…¼å®¹æ€§
- **Chrome 25+** - å®Œæ•´æ”¯æŒ
- **Firefox 44+** - å®Œæ•´æ”¯æŒ  
- **Safari 14.1+** - å®Œæ•´æ”¯æŒ
- **Edge 79+** - å®Œæ•´æ”¯æŒ

> **æ³¨æ„**ï¼šè¯­éŸ³è¯†åˆ«åŠŸèƒ½éœ€è¦HTTPSç¯å¢ƒæˆ–localhost

## ğŸ¨ æ ·å¼å®šåˆ¶

### CSSå˜é‡å®šåˆ¶
```css
.ai-bubble-container {
  /* æ‚¬æµ®çƒé¢œè‰² */
  --bubble-bg: linear-gradient(45deg, #7b64d3, #5a8cf3);
  
  /* èŠå¤©é¢æ¿å°ºå¯¸ */
  --panel-width: 400px;
  --panel-height: 520px;
  
  /* ä¸»é¢˜è‰² */
  --primary-color: #007bff;
  --success-color: #4caf50;
}
```

### å“åº”å¼é€‚é…
```css
@media (max-width: 768px) {
  .chat-panel {
    width: 90vw;
    height: 70vh;
    left: 5vw;
  }
}
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¯­éŸ³è¯†åˆ«ä¸å·¥ä½œ
```bash
# æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
console.log('æ”¯æŒè¯­éŸ³è¯†åˆ«:', !!window.SpeechRecognition || !!window.webkitSpeechRecognition)

# æ£€æŸ¥æƒé™
navigator.permissions.query({name: 'microphone'})
```

#### 2. ç½‘ç»œé”™è¯¯å¤„ç†
å½“é‡åˆ°ç½‘ç»œé—®é¢˜æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§åˆ°MediaRecorderæ¨¡å¼ï¼Œè®°å½•éŸ³é¢‘ä½†ä¸è¿›è¡Œå®æ—¶è¯†åˆ«ã€‚

#### 3. è·¨åŸŸé—®é¢˜
```javascript
// vite.config.ts
export default defineConfig({
  server: {
    headers: {
      'Cross-Origin-Embedder-Policy': 'unsafe-none',
      'Cross-Origin-Opener-Policy': 'unsafe-none'
    }
  }
})
```

### è°ƒè¯•æ¨¡å¼
æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š
- `[ASR]` - è¯­éŸ³è¯†åˆ«ç›¸å…³
- `[æµå¼è¾“å…¥]` - å®æ—¶æ–‡æœ¬æ›´æ–°
- `[è¯­éŸ³æŒ‡ä»¤]` - æŒ‡ä»¤å¤„ç†
- `[è‡ªåŠ¨å‘é€]` - è‡ªåŠ¨å‘é€é€»è¾‘
- `[å­˜å‚¨]` - æ•°æ®æŒä¹…åŒ–

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ï¼

### å¼€å‘ç¯å¢ƒè®¾ç½®
```bash
# å¼€å‘æ¨¡å¼
pnpm run dev

# æ„å»ºæµ‹è¯•
pnpm run build:wc

# ç±»å‹æ£€æŸ¥
pnpm run type-check
```

---

> **æç¤º**ï¼šé¦–æ¬¡ä½¿ç”¨æ—¶ï¼Œæµè§ˆå™¨ä¼šè¯·æ±‚éº¦å…‹é£æƒé™ï¼Œè¯·ç¡®ä¿å…è®¸è®¿é—®ä»¥ä½¿ç”¨è¯­éŸ³åŠŸèƒ½ã€‚

