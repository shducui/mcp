(function(n,J){typeof exports=="object"&&typeof module<"u"?J(require("vue")):typeof define=="function"&&define.amd?define(["vue"],J):(n=typeof globalThis<"u"?globalThis:n||self,J(n.Vue))})(this,function(n){"use strict";var J="vercel.ai.error",We=Symbol.for(J),ye,qe=class Ke extends Error{constructor({name:t,message:r,cause:a}){super(r),this[ye]=!0,this.name=t,this.cause=a}static isInstance(t){return Ke.hasMarker(t,J)}static hasMarker(t,r){const a=Symbol.for(r);return t!=null&&typeof t=="object"&&a in t&&typeof t[a]=="boolean"&&t[a]===!0}};ye=We;var U=qe;function ge(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Ee="AI_InvalidArgumentError",be=`vercel.ai.error.${Ee}`,Ge=Symbol.for(be),_e,He=class extends U{constructor({message:e,cause:t,argument:r}){super({name:Ee,message:e,cause:t}),this[_e]=!0,this.argument=r}static isInstance(e){return U.hasMarker(e,be)}};_e=Ge;var we="AI_JSONParseError",Ie=`vercel.ai.error.${we}`,Xe=Symbol.for(Ie),ve,ke=class extends U{constructor({text:e,cause:t}){super({name:we,message:`JSON parsing failed: Text: ${e}.
Error message: ${ge(t)}`,cause:t}),this[ve]=!0,this.text=e}static isInstance(e){return U.hasMarker(e,Ie)}};ve=Xe;var Se="AI_TypeValidationError",Te=`vercel.ai.error.${Se}`,Qe=Symbol.for(Te),Ne,Ze=class he extends U{constructor({value:t,cause:r}){super({name:Se,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${ge(r)}`,cause:r}),this[Ne]=!0,this.value=t}static isInstance(t){return U.hasMarker(t,Te)}static wrap({value:t,cause:r}){return he.isInstance(r)&&r.value===t?r:new he({value:t,cause:r})}};Ne=Qe;var Re=Ze;let et=(e,t=21)=>(r=t)=>{let a="",l=r|0;for(;l--;)a+=e[Math.random()*e.length|0];return a};function tt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var j={exports:{}},Ae;function rt(){if(Ae)return j.exports;Ae=1;const e=typeof Buffer<"u",t=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,r=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function a(p,u,s){s==null&&u!==null&&typeof u=="object"&&(s=u,u=void 0),e&&Buffer.isBuffer(p)&&(p=p.toString()),p&&p.charCodeAt(0)===65279&&(p=p.slice(1));const d=JSON.parse(p,u);if(d===null||typeof d!="object")return d;const f=s&&s.protoAction||"error",g=s&&s.constructorAction||"error";if(f==="ignore"&&g==="ignore")return d;if(f!=="ignore"&&g!=="ignore"){if(t.test(p)===!1&&r.test(p)===!1)return d}else if(f!=="ignore"&&g==="ignore"){if(t.test(p)===!1)return d}else if(r.test(p)===!1)return d;return l(d,{protoAction:f,constructorAction:g,safe:s&&s.safe})}function l(p,{protoAction:u="error",constructorAction:s="error",safe:d}={}){let f=[p];for(;f.length;){const g=f;f=[];for(const y of g){if(u!=="ignore"&&Object.prototype.hasOwnProperty.call(y,"__proto__")){if(d===!0)return null;if(u==="error")throw new SyntaxError("Object contains forbidden prototype property");delete y.__proto__}if(s!=="ignore"&&Object.prototype.hasOwnProperty.call(y,"constructor")&&Object.prototype.hasOwnProperty.call(y.constructor,"prototype")){if(d===!0)return null;if(s==="error")throw new SyntaxError("Object contains forbidden prototype property");delete y.constructor}for(const I in y){const S=y[I];S&&typeof S=="object"&&f.push(S)}}}return p}function o(p,u,s){const d=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return a(p,u,s)}finally{Error.stackTraceLimit=d}}function h(p,u){const s=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return a(p,u,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=s}}return j.exports=o,j.exports.default=o,j.exports.parse=o,j.exports.safeParse=h,j.exports.scan=l,j.exports}var nt=rt();const at=tt(nt);var ot=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{const l=et(r,t);if(e==null)return l;if(r.includes(a))throw new He({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return o=>`${e}${a}${l(o)}`},ae=ot(),oe=Symbol.for("vercel.ai.validator");function st(e){return{[oe]:!0,validate:e}}function it(e){return typeof e=="object"&&e!==null&&oe in e&&e[oe]===!0&&"validate"in e}function lt(e){return it(e)?e:ct(e)}function ct(e){return st(t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function ut({value:e,schema:t}){const r=lt(t);try{if(r.validate==null)return{success:!0,value:e};const a=r.validate(e);return a.success?a:{success:!1,error:Re.wrap({value:e,cause:a.error})}}catch(a){return{success:!1,error:Re.wrap({value:e,cause:a})}}}function Ce({text:e,schema:t}){try{const r=at.parse(e);if(t==null)return{success:!0,value:r,rawValue:r};const a=ut({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(r){return{success:!1,error:ke.isInstance(r)?r:new ke({text:e,cause:r})}}}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var K={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},W={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},q={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},G={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},H={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},dt=[K,W,q,G,H];K.code+"",W.code+"",q.code+"",G.code+"",H.code+"",K.name+"",K.code,W.name+"",W.code,q.name+"",q.code,G.name+"",G.code,H.name+"",H.code,dt.map(e=>e.code);function ft({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function pt(e){const t=["ROOT"];let r=-1,a=null;function l(u,s,d){switch(u){case'"':{r=s,t.pop(),t.push(d),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{r=s,a=s,t.pop(),t.push(d),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(d),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=s,t.pop(),t.push(d),t.push("INSIDE_NUMBER");break}case"{":{r=s,t.pop(),t.push(d),t.push("INSIDE_OBJECT_START");break}case"[":{r=s,t.pop(),t.push(d),t.push("INSIDE_ARRAY_START");break}}}function o(u,s){switch(u){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{r=s,t.pop();break}}}function h(u,s){switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=s,t.pop();break}}}for(let u=0;u<e.length;u++){const s=e[u];switch(t[t.length-1]){case"ROOT":l(s,u,"FINISH");break;case"INSIDE_OBJECT_START":{switch(s){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{r=u,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(s){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(s){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(s){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{l(s,u,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{o(s,u);break}case"INSIDE_STRING":{switch(s){case'"':{t.pop(),r=u;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:r=u}break}case"INSIDE_ARRAY_START":{switch(s){case"]":{r=u,t.pop();break}default:{r=u,l(s,u,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(s){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=u,t.pop();break}default:{r=u;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{l(s,u,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),r=u;break}case"INSIDE_NUMBER":{switch(s){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=u;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&h(s,u),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(s,u);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(s,u);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&h(s,u);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const f=e.substring(a,u+1);!"false".startsWith(f)&&!"true".startsWith(f)&&!"null".startsWith(f)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?o(s,u):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&h(s,u)):r=u;break}}}let p=e.slice(0,r+1);for(let u=t.length-1;u>=0;u--)switch(t[u]){case"INSIDE_STRING":{p+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{p+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{p+="]";break}case"INSIDE_LITERAL":{const d=e.substring(a,e.length);"true".startsWith(d)?p+="true".slice(d.length):"false".startsWith(d)?p+="false".slice(d.length):"null".startsWith(d)&&(p+="null".slice(d.length))}}return p}function mt(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=Ce({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=Ce({text:pt(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var ht={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},yt={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},gt={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},Et={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},bt={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},_t={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},wt={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},It={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},vt={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},kt={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},St={code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},Tt={code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},Nt={code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},Rt={code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},At={code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},Ct={code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}},se=[ht,yt,gt,Et,bt,_t,wt,It,vt,kt,St,Tt,Nt,Rt,At,Ct],xt=Object.fromEntries(se.map(e=>[e.code,e]));Object.fromEntries(se.map(e=>[e.name,e.code]));var Dt=se.map(e=>e.code),Vt=e=>{const t=e.indexOf(":");if(t===-1)throw new Error("Failed to parse stream string. No separator found.");const r=e.slice(0,t);if(!Dt.includes(r))throw new Error(`Failed to parse stream string. Invalid code ${r}.`);const a=r,l=e.slice(t+1),o=JSON.parse(l);return xt[a].parse(o)},Ot=10;function Bt(e,t){const r=new Uint8Array(t);let a=0;for(const l of e)r.set(l,a),a+=l.length;return e.length=0,r}async function Lt({stream:e,onTextPart:t,onReasoningPart:r,onReasoningSignaturePart:a,onRedactedReasoningPart:l,onSourcePart:o,onFilePart:h,onDataPart:p,onErrorPart:u,onToolCallStreamingStartPart:s,onToolCallDeltaPart:d,onToolCallPart:f,onToolResultPart:g,onMessageAnnotationsPart:y,onFinishMessagePart:I,onFinishStepPart:S,onStartStepPart:N}){const R=e.getReader(),v=new TextDecoder,E=[];let k=0;for(;;){const{value:b}=await R.read();if(b&&(E.push(b),k+=b.length,b[b.length-1]!==Ot))continue;if(E.length===0)break;const c=Bt(E,k);k=0;const i=v.decode(c,{stream:!0}).split(`
`).filter(m=>m!=="").map(Vt);for(const{type:m,value:_}of i)switch(m){case"text":await t?.(_);break;case"reasoning":await r?.(_);break;case"reasoning_signature":await a?.(_);break;case"redacted_reasoning":await l?.(_);break;case"file":await h?.(_);break;case"source":await o?.(_);break;case"data":await p?.(_);break;case"error":await u?.(_);break;case"message_annotations":await y?.(_);break;case"tool_call_streaming_start":await s?.(_);break;case"tool_call_delta":await d?.(_);break;case"tool_call":await f?.(_);break;case"tool_result":await g?.(_);break;case"finish_message":await I?.(_);break;case"finish_step":await S?.(_);break;case"start_step":await N?.(_);break;default:{const T=m;throw new Error(`Unknown stream part type: ${T}`)}}}}async function Mt({stream:e,update:t,onToolCall:r,onFinish:a,generateId:l=ae,getCurrentDate:o=()=>new Date,lastMessage:h}){var p,u;const s=h?.role==="assistant";let d=s?1+((u=(p=h.toolInvocations)==null?void 0:p.reduce((c,i)=>{var m;return Math.max(c,(m=i.step)!=null?m:0)},0))!=null?u:0):0;const f=s?structuredClone(h):{id:l(),createdAt:o(),role:"assistant",content:"",parts:[]};let g,y,I;function S(c,i){const m=f.parts.find(_=>_.type==="tool-invocation"&&_.toolInvocation.toolCallId===c);m!=null?m.toolInvocation=i:f.parts.push({type:"tool-invocation",toolInvocation:i})}const N=[];let R=s?h?.annotations:void 0;const v={};let E={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},k="unknown";function b(){const c=[...N];R?.length&&(f.annotations=R);const i={...structuredClone(f),revisionId:l()};t({message:i,data:c,replaceLastMessage:s})}await Lt({stream:e,onTextPart(c){g==null?(g={type:"text",text:c},f.parts.push(g)):g.text+=c,f.content+=c,b()},onReasoningPart(c){var i;I==null?(I={type:"text",text:c},y?.details.push(I)):I.text+=c,y==null?(y={type:"reasoning",reasoning:c,details:[I]},f.parts.push(y)):y.reasoning+=c,f.reasoning=((i=f.reasoning)!=null?i:"")+c,b()},onReasoningSignaturePart(c){I!=null&&(I.signature=c.signature)},onRedactedReasoningPart(c){y==null&&(y={type:"reasoning",reasoning:"",details:[]},f.parts.push(y)),y.details.push({type:"redacted",data:c.data}),I=void 0,b()},onFilePart(c){f.parts.push({type:"file",mimeType:c.mimeType,data:c.data}),b()},onSourcePart(c){f.parts.push({type:"source",source:c}),b()},onToolCallStreamingStartPart(c){f.toolInvocations==null&&(f.toolInvocations=[]),v[c.toolCallId]={text:"",step:d,toolName:c.toolName,index:f.toolInvocations.length};const i={state:"partial-call",step:d,toolCallId:c.toolCallId,toolName:c.toolName,args:void 0};f.toolInvocations.push(i),S(c.toolCallId,i),b()},onToolCallDeltaPart(c){const i=v[c.toolCallId];i.text+=c.argsTextDelta;const{value:m}=mt(i.text),_={state:"partial-call",step:i.step,toolCallId:c.toolCallId,toolName:i.toolName,args:m};f.toolInvocations[i.index]=_,S(c.toolCallId,_),b()},async onToolCallPart(c){const i={state:"call",step:d,...c};if(v[c.toolCallId]!=null?f.toolInvocations[v[c.toolCallId].index]=i:(f.toolInvocations==null&&(f.toolInvocations=[]),f.toolInvocations.push(i)),S(c.toolCallId,i),b(),r){const m=await r({toolCall:c});if(m!=null){const _={state:"result",step:d,...c,result:m};f.toolInvocations[f.toolInvocations.length-1]=_,S(c.toolCallId,_),b()}}},onToolResultPart(c){const i=f.toolInvocations;if(i==null)throw new Error("tool_result must be preceded by a tool_call");const m=i.findIndex(T=>T.toolCallId===c.toolCallId);if(m===-1)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");const _={...i[m],state:"result",...c};i[m]=_,S(c.toolCallId,_),b()},onDataPart(c){N.push(...c),b()},onMessageAnnotationsPart(c){R==null?R=[...c]:R.push(...c),b()},onFinishStepPart(c){d+=1,g=c.isContinued?g:void 0,y=void 0,I=void 0},onStartStepPart(c){s||(f.id=c.messageId),f.parts.push({type:"step-start"}),b()},onFinishMessagePart(c){k=c.finishReason,c.usage!=null&&(E=ft(c.usage))},onErrorPart(c){throw new Error(c)}}),a?.({message:f,finishReason:k,usage:E})}async function Pt({stream:e,onTextPart:t}){const r=e.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:a,value:l}=await r.read();if(a)break;await t(l)}}async function jt({stream:e,update:t,onFinish:r,getCurrentDate:a=()=>new Date,generateId:l=ae}){const o={type:"text",text:""},h={id:l(),createdAt:a(),role:"assistant",content:"",parts:[o]};await Pt({stream:e,onTextPart:p=>{h.content+=p,o.text+=p,t({message:{...h},data:[],replaceLastMessage:!1})}}),r?.(h,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"})}var Ft=()=>fetch;async function Jt({api:e,body:t,streamProtocol:r="data",credentials:a,headers:l,abortController:o,restoreMessagesOnFailure:h,onResponse:p,onUpdate:u,onFinish:s,onToolCall:d,generateId:f,fetch:g=Ft(),lastMessage:y,requestType:I="generate"}){var S,N,R;const E=await(I==="resume"?g(`${e}?chatId=${t.id}`,{method:"GET",headers:{"Content-Type":"application/json",...l},signal:(S=o?.())==null?void 0:S.signal,credentials:a}):g(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...l},signal:(N=o?.())==null?void 0:N.signal,credentials:a})).catch(k=>{throw h(),k});if(p)try{await p(E)}catch(k){throw k}if(!E.ok)throw h(),new Error((R=await E.text())!=null?R:"Failed to fetch the chat response.");if(!E.body)throw new Error("The response body is empty.");switch(r){case"text":{await jt({stream:E.body,update:u,onFinish:s,generateId:f});return}case"data":{await Mt({stream:E.body,update:u,lastMessage:y,onToolCall:d,onFinish({message:k,finishReason:b,usage:c}){s&&k!=null&&s(k,{usage:c,finishReason:b})},generateId:f});return}default:{const k=r;throw new Error(`Unknown stream protocol: ${k}`)}}}function ie(e){return e?.reduce((t,r)=>{var a;return Math.max(t,(a=r.step)!=null?a:0)},0)}function xe(e){var t;return(t=e.parts)!=null?t:[...e.toolInvocations?e.toolInvocations.map(r=>({type:"tool-invocation",toolInvocation:r})):[],...e.reasoning?[{type:"reasoning",reasoning:e.reasoning,details:[{type:"text",text:e.reasoning}]}]:[],...e.content?[{type:"text",text:e.content}]:[]]}function ee(e){return e.map(t=>({...t,parts:xe(t)}))}async function De(e){if(!e)return[];if(globalThis.FileList&&e instanceof globalThis.FileList)return Promise.all(Array.from(e).map(async t=>{const{name:r,type:a}=t,l=await new Promise((o,h)=>{const p=new FileReader;p.onload=u=>{var s;o((s=u.target)==null?void 0:s.result)},p.onerror=u=>h(u),p.readAsDataURL(t)});return{name:r,contentType:a,url:l}}));if(Array.isArray(e))return e;throw new Error("Invalid attachments type")}function Ut({originalMaxToolInvocationStep:e,originalMessageCount:t,maxSteps:r,messages:a}){var l;const o=a[a.length-1];return r>1&&o!=null&&(a.length>t||ie(o.toolInvocations)!==e)&&Ve(o)&&((l=ie(o.toolInvocations))!=null?l:0)<r}function Ve(e){if(e.role!=="assistant")return!1;const t=e.parts.reduce((a,l,o)=>l.type==="step-start"?o:a,-1),r=e.parts.slice(t+1).filter(a=>a.type==="tool-invocation");return r.length>0&&r.every(a=>"result"in a.toolInvocation)}function Yt({messages:e,toolCallId:t,toolResult:r}){var a;const l=e[e.length-1],o=l.parts.find(p=>p.type==="tool-invocation"&&p.toolInvocation.toolCallId===t);if(o==null)return;const h={...o.toolInvocation,state:"result",result:r};o.toolInvocation=h,l.toolInvocations=(a=l.toolInvocations)==null?void 0:a.map(p=>p.toolCallId===t?h:p)}var le=new WeakMap,Oe=0;function $t(e){if(!e.length)return"";for(var t="arg",r=0;r<e.length;++r){var a=void 0;e[r]===null||typeof e[r]!="object"&&typeof e[r]!="function"?typeof e[r]=="string"?a='"'+e[r]+'"':a=String(e[r]):le.has(e[r])?a=le.get(e[r]):(a=Oe,le.set(e[r],Oe++)),t+="@"+a}return t}function zt(e){if(typeof e=="function")try{e=e()}catch{e=""}return Array.isArray(e)?e=$t(e):e=String(e||""),e}var ce=function(){function e(t){t===void 0&&(t=0),this.items=new Map,this.ttl=t}return e.prototype.serializeKey=function(t){return zt(t)},e.prototype.get=function(t){var r=this.serializeKey(t);return this.items.get(r)},e.prototype.set=function(t,r,a){var l=this.serializeKey(t),o=a||this.ttl,h=Date.now(),p={data:r,createdAt:h,expiresAt:o?h+o:1/0};this.dispatchExpire(o,p,l),this.items.set(l,p)},e.prototype.dispatchExpire=function(t,r,a){var l=this;t&&setTimeout(function(){var o=Date.now(),h=o>=r.expiresAt;h&&l.delete(a)},t)},e.prototype.delete=function(t){this.items.delete(t)},e}();function Kt(){return typeof navigator.onLine<"u"?navigator.onLine:!0}function Wt(){return typeof document<"u"&&typeof document.visibilityState<"u"?document.visibilityState!=="hidden":!0}var qt=function(e){return fetch(e).then(function(t){return t.json()})};const ue={isOnline:Kt,isDocumentVisible:Wt,fetcher:qt};var B=function(){return B=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++){t=arguments[r];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},B.apply(this,arguments)},Y=function(e,t,r,a){function l(o){return o instanceof r?o:new r(function(h){h(o)})}return new(r||(r=Promise))(function(o,h){function p(d){try{s(a.next(d))}catch(f){h(f)}}function u(d){try{s(a.throw(d))}catch(f){h(f)}}function s(d){d.done?o(d.value):l(d.value).then(p,u)}s((a=a.apply(e,t||[])).next())})},$=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},a,l,o,h;return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(s){return function(d){return u([s,d])}}function u(s){if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,l&&(o=s[0]&2?l.return:s[0]?l.throw||((o=l.return)&&o.call(l),0):l.next)&&!(o=o.call(l,s[1])).done)return o;switch(l=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,l=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(s[0]===6&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(d){s=[6,d],l=0}finally{a=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Gt=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),l,o=[],h;try{for(;(t===void 0||t-- >0)&&!(l=a.next()).done;)o.push(l.value)}catch(p){h={error:p}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(h)throw h.error}}return o},Ht=function(e,t,r){if(r||arguments.length===2)for(var a=0,l=t.length,o;a<l;a++)(o||!(a in t))&&(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))},Be=new ce,te=new ce,de=new ce,Le={cache:Be,refreshInterval:0,ttl:0,serverTTL:1e3,dedupingInterval:2e3,revalidateOnFocus:!0,revalidateDebounce:0,shouldRetryOnError:!0,errorRetryInterval:5e3,errorRetryCount:5,fetcher:ue.fetcher,isOnline:ue.isOnline,isDocumentVisible:ue.isDocumentVisible};function Xt(e,t,r){var a=te.get(e);if(a)a.data.push(t);else{var l=5e3;te.set(e,[t],r>0?r+l:r)}}function Qt(e,t,r){if(r.isDocumentVisible()&&!(r.errorRetryCount!==void 0&&t>r.errorRetryCount)){var a=Math.min(t||0,r.errorRetryCount),l=a*r.errorRetryInterval;setTimeout(function(){e(null,{errorRetryCount:a+1,shouldRetryOnError:!0})},l)}}var Me=function(e,t,r,a){return r===void 0&&(r=Be),a===void 0&&(a=Le.ttl),Y(void 0,void 0,void 0,function(){var l,o,h,p,u,s,d;return $(this,function(f){switch(f.label){case 0:if(!Zt(t))return[3,5];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,t];case 2:return l=f.sent(),[3,4];case 3:return p=f.sent(),o=p,[3,4];case 4:return[3,6];case 5:l=t,f.label=6;case 6:if(h=!1,u={data:l,error:o,isValidating:h},typeof l<"u")try{r.set(e,u,a)}catch(g){console.error("swrv(mutate): failed to set cache",g)}return s=te.get(e),s&&s.data.length&&(d=s.data.filter(function(g){return g.key===e}),d.forEach(function(g,y){typeof u.data<"u"&&(g.data=u.data),g.error=u.error,g.isValidating=u.isValidating,g.isLoading=u.isValidating;var I=y===d.length-1;I||delete d[y]}),d=d.filter(Boolean)),[2,u]}})})};function Pe(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var a,l,o=B({},Le),h=!1,p=!1,u=n.getCurrentInstance(),s=u?.proxy||u;if(!s)return console.error("Could not get current instance, check to make sure that `useSwrv` is declared in the top level of the setup function."),null;var d=s?.$isServer||!1;t.length>=1&&(a=t[0]),t.length>=2&&(l=t[1]),t.length>2&&(o=B(B({},o),t[2]));var f=d?o.serverTTL:o.ttl,g=typeof a=="function"?a:n.ref(a);typeof l>"u"&&(l=o.fetcher);var y=null;y||(y=n.reactive({data:void 0,error:void 0,isValidating:!0,isLoading:!0,key:null}));var I=function(v,E){return Y(e,void 0,void 0,function(){var k,b,c,i,m,_,T,M=this;return $(this,function(D){switch(D.label){case 0:return k=y.data===void 0,b=g.value,b?(c=o.cache.get(b),i=c&&c.data,y.isValidating=!0,y.isLoading=!i,i&&(y.data=i.data,y.error=i.error),m=v||l,!m||!o.isDocumentVisible()&&!k||E?.forceRevalidate!==void 0&&!E?.forceRevalidate?(y.isValidating=!1,y.isLoading=!1,[2]):c&&(_=!!(Date.now()-c.createdAt>=o.dedupingInterval||E?.forceRevalidate),!_)?(y.isValidating=!1,y.isLoading=!1,[2]):(T=function(){return Y(M,void 0,void 0,function(){var A,V,X,re;return $(this,function(z){switch(z.label){case 0:return A=de.get(b),A?[3,2]:(V=Array.isArray(b)?b:[b],X=m.apply(void 0,Ht([],Gt(V),!1)),de.set(b,X,o.dedupingInterval),[4,Me(b,X,o.cache,f)]);case 1:return z.sent(),[3,4];case 2:return[4,Me(b,A.data,o.cache,f)];case 3:z.sent(),z.label=4;case 4:return y.isValidating=!1,y.isLoading=!1,de.delete(b),y.error!==void 0&&(re=!h&&o.shouldRetryOnError&&(E?E.shouldRetryOnError:!0),re&&Qt(I,E?E.errorRetryCount:1,o)),[2]}})})},i&&o.revalidateDebounce?(setTimeout(function(){return Y(M,void 0,void 0,function(){return $(this,function(A){switch(A.label){case 0:return h?[3,2]:[4,T()];case 1:A.sent(),A.label=2;case 2:return[2]}})})},o.revalidateDebounce),[3,3]):[3,1])):[2];case 1:return[4,T()];case 2:D.sent(),D.label=3;case 3:return[2]}})})},S=function(){return Y(e,void 0,void 0,function(){return $(this,function(v){return[2,I(null,{shouldRetryOnError:!1})]})})},N=null;n.onMounted(function(){var v=function(){return Y(e,void 0,void 0,function(){return $(this,function(E){switch(E.label){case 0:return!y.error&&o.isOnline()?[4,I()]:[3,2];case 1:return E.sent(),[3,3];case 2:N&&clearTimeout(N),E.label=3;case 3:return o.refreshInterval&&!h&&(N=setTimeout(v,o.refreshInterval)),[2]}})})};o.refreshInterval&&(N=setTimeout(v,o.refreshInterval)),o.revalidateOnFocus&&(document.addEventListener("visibilitychange",S,!1),window.addEventListener("focus",S,!1))}),n.onUnmounted(function(){h=!0,N&&clearTimeout(N),o.revalidateOnFocus&&(document.removeEventListener("visibilitychange",S,!1),window.removeEventListener("focus",S,!1));var v=te.get(g.value);v&&(v.data=v.data.filter(function(E){return E!==y}))});try{n.watch(g,function(v){n.isReadonly(g)||(g.value=v),y.key=v,y.isValidating=!!v,Xt(g.value,y,f),!d&&!p&&g.value&&I(),p=!1},{immediate:!0})}catch{}var R=B(B({},n.toRefs(y)),{mutate:function(v,E){return I(v,B(B({},E),{forceRevalidate:!0}))}});return R}function Zt(e){return e!==null&&typeof e=="object"&&typeof e.then=="function"}var er=Pe.default||Pe,je={},Fe={};function tr({api:e="/api/chat",id:t,initialMessages:r=[],initialInput:a="",sendExtraMessageFields:l,streamProtocol:o="data",onResponse:h,onFinish:p,onError:u,credentials:s,headers:d,body:f,generateId:g=ae,onToolCall:y,fetch:I,keepLastMessageOnError:S=!0,maxSteps:N=1,experimental_prepareRequestBody:R}={maxSteps:1}){var v,E;const k=t??g(),b=`${e}|${k}`,{data:c,mutate:i}=er(b,()=>{var w;return(w=je[b])!=null?w:ee(r)}),m=(v=Fe[k])!=null?v:Fe[k]=n.ref("ready");(E=c.value)!=null||(c.value=ee(r));const _=w=>(je[b]=w,i()),T=c,M=n.ref(void 0),D=n.ref(void 0);let A=null;async function V(w,{data:C,headers:x,body:O}={}){var P,Q,Je;M.value=void 0,m.value="submitted";const Sr=T.value.length,Tr=ie((P=T.value[T.value.length-1])==null?void 0:P.toolInvocations);try{A=new AbortController;const F=ee(w),L=F;_(L);const Nr=(Q=D.value)!=null?Q:[],Rr=l?L:L.map(({role:me,content:Z,experimental_attachments:ne,data:Ue,annotations:Ye,toolInvocations:$e,parts:ze})=>({role:me,content:Z,...ne!==void 0&&{experimental_attachments:ne},...Ue!==void 0&&{data:Ue},...Ye!==void 0&&{annotations:Ye},...$e!==void 0&&{toolInvocations:$e},...ze!==void 0&&{parts:ze}}));await Jt({api:e,body:(Je=R?.({id:k,messages:L,requestData:C,requestBody:O}))!=null?Je:{id:k,messages:Rr,data:C,...n.unref(f),...O},streamProtocol:o,headers:{...d,...x},abortController:()=>A,credentials:s,onResponse:h,onUpdate({message:me,data:Z,replaceLastMessage:ne}){m.value="streaming",_([...ne?L.slice(0,L.length-1):L,me]),Z?.length&&(D.value=[...Nr,...Z])},onFinish:p,restoreMessagesOnFailure(){S||_(F)},generateId:g,onToolCall:y,fetch:I,lastMessage:fe(L[L.length-1])}),m.value="ready"}catch(F){if(F.name==="AbortError")return A=null,m.value="ready",null;u&&F instanceof Error&&u(F),M.value=F,m.value="error"}finally{A=null}Ut({originalMaxToolInvocationStep:Tr,originalMessageCount:Sr,maxSteps:N,messages:T.value})&&await V(T.value)}const X=async(w,C)=>{var x,O,P;const Q=await De((x=C?.experimental_attachments)!=null?x:w.experimental_attachments);return V(T.value.concat({...w,id:(O=w.id)!=null?O:g(),createdAt:(P=w.createdAt)!=null?P:new Date,experimental_attachments:Q.length>0?Q:void 0,parts:xe(w)}),C)},re=async w=>{const C=T.value;return C.length===0?null:C[C.length-1].role==="assistant"?V(C.slice(0,-1),w):V(C,w)},z=()=>{A&&(A.abort(),A=null)},wr=w=>{typeof w=="function"&&(w=w(T.value)),_(ee(w))},Ir=w=>{typeof w=="function"&&(w=w(D.value)),D.value=w},pe=n.ref(a),vr=async(w,C={})=>{var x;(x=w?.preventDefault)==null||x.call(w);const O=pe.value;if(!O&&!C.allowEmptySubmit)return;const P=await De(C.experimental_attachments);V(T.value.concat({id:g(),createdAt:new Date,content:O,role:"user",experimental_attachments:P.length>0?P:void 0,parts:[{type:"text",text:O}]}),C),pe.value=""},kr=({toolCallId:w,result:C})=>{const x=T.value;if(Yt({messages:x,toolCallId:w,toolResult:C}),_(x),m.value==="submitted"||m.value==="streaming")return;const O=x[x.length-1];Ve(O)&&V(x)};return{id:k,messages:T,append:X,error:M,reload:re,stop:z,setMessages:wr,input:pe,handleSubmit:vr,isLoading:n.computed(()=>m.value==="submitted"||m.value==="streaming"),status:m,data:D,setData:Ir,addToolResult:kr}}function fe(e){if(Array.isArray(e))return[...e.map(fe)];if(typeof e=="object"&&e!==null){const t={};for(const[r,a]of Object.entries(e))t[r]=fe(a);return t}else return e}function rr(e){const t=n.ref(!1),r=n.ref("");let a=null,l=[];const o=async()=>{if(!t.value)try{const u=await navigator.mediaDevices.getUserMedia({audio:!0});a=new MediaRecorder(u),l=[],a.ondataavailable=s=>{l.push(s.data)},a.onstop=async()=>{const s=new Blob(l,{type:a?.mimeType});await p(s),u.getTracks().forEach(d=>d.stop())},a.start(),t.value=!0,r.value=""}catch(u){r.value=`启动录音失败: ${u.message}`}},h=()=>{!t.value||!a||(a.stop(),t.value=!1)},p=async u=>{const s=new FormData;s.append("audio",u,"recording.webm");try{const d=await fetch("/api/transcribe",{method:"POST",body:s});if(!d.ok)throw new Error("转录请求失败");const f=await d.json();f.transcript&&e(f.transcript)}catch(d){r.value=`上传音频失败: ${d.message}`}};return{isRecording:n.readonly(t),error:n.readonly(r),start:o,stop:h}}const nr={class:"ai-bubble-container"},ar={class:"toolbar"},or=["value"],sr={class:"messages-area"},ir={class:"message-bubble ai-bubble"},lr=["src"],cr={key:1,class:"text-content"},ur={class:"message-bubble user-bubble"},dr={class:"text-content"},fr={key:0,class:"message-wrapper"},pr={class:"message-row"},mr={class:"message-bubble ai-bubble"},hr={key:0,class:"dice-animation"},yr={key:1},gr=["disabled"],Er={class:"modal-content"},br=n.defineComponent({__name:"AiChatBubble",props:{apiUrl:{}},setup(e){const t=e,{messages:r,input:a,handleSubmit:l,isLoading:o}=tr({api:t.apiUrl}),{isRecording:h,start:p,stop:u}=rr(c=>{const i=c.trim();if(["发送","提交","发出"].includes(i)){l();return}if(["清空","清除","删除"].includes(i)){a.value="";return}if(["打开日志","显示日志","日志"].includes(i)){d.value=!0;return}if(["关闭","隐藏"].includes(i)){d.value=!1,f.value=!1;return}if(["打开窗口","备注","语音库"].includes(i)){f.value=!0;return}a.value=i}),s=n.ref(!1),d=n.ref(!1),f=n.ref(!1),g=n.reactive({x:600,y:80}),y=n.reactive({x:600,y:200}),I=n.ref("#ffffff"),S=[{name:"白色",value:"#ffffff"},{name:"浅灰",value:"#f7f7f7"},{name:"青色",value:"#e0f7fa"},{name:"橙色",value:"#ffe0b2"},{name:"粉色",value:"#fce4ec"},{name:"绿色",value:"#e8f5e9"},{name:"蓝色",value:"#e3f2fd"},{name:"紫色",value:"#f3e5f5"}];function N(){s.value=!s.value,s.value||(d.value=!1,f.value=!1)}const R=n.ref(null);function v(c){return c.trim().startsWith("<audio")}function E(c){const i=c.match(/src="([^"]+)"/);return i?i[1]:null}const k=n.computed(()=>{if(!o.value)return!1;const c=[...r.value].reverse().find(i=>i.role==="user");return!!(c&&/摇骰子|摇色子|掷骰子/.test(c.content))});n.watch(r,async c=>{const i=c[c.length-1];if(i?.role==="assistant"&&v(i.content)){if(!E(i.content))return;await n.nextTick(),R.value?.play().catch(()=>{console.warn("Audio autoplay was prevented by the browser.")})}},{deep:!0});function b(c,i){i.preventDefault();const m=i.clientX,_=i.clientY,T=c.x,M=c.y;function D(V){c.x=T+(V.clientX-m),c.y=M+(V.clientY-_)}function A(){document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",A)}document.addEventListener("mousemove",D),document.addEventListener("mouseup",A)}return n.onMounted(()=>{}),(c,i)=>(n.openBlock(),n.createElementBlock("div",nr,[n.createElementVNode("div",{class:"floating-button",onClick:N}," 🤖 AI "),s.value?(n.openBlock(),n.createElementBlock("div",{key:0,class:"chat-main",style:n.normalizeStyle({backgroundColor:I.value})},[n.createElementVNode("div",ar,[n.createElementVNode("button",{class:"toolbar-btn",onClick:i[0]||(i[0]=m=>d.value=!0)},"📜日志"),n.createElementVNode("button",{class:"toolbar-btn",onClick:i[1]||(i[1]=m=>f.value=!0)},"📚备注"),n.withDirectives(n.createElementVNode("select",{"onUpdate:modelValue":i[2]||(i[2]=m=>I.value=m),class:"theme-select"},[(n.openBlock(),n.createElementBlock(n.Fragment,null,n.renderList(S,m=>n.createElementVNode("option",{key:m.value,value:m.value},n.toDisplayString(m.name),9,or)),64))],512),[[n.vModelSelect,I.value]]),n.createElementVNode("button",{class:"toolbar-btn close-chat-btn",onClick:N},"❌")]),n.createElementVNode("div",sr,[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(n.unref(r),m=>(n.openBlock(),n.createElementBlock("div",{key:m.id,class:n.normalizeClass(["message-wrapper",{"is-user":m.role==="user"}])},[n.createElementVNode("div",{class:n.normalizeClass(["message-row",{"is-user-row":m.role==="user"}])},[m.role==="assistant"?(n.openBlock(),n.createElementBlock(n.Fragment,{key:0},[i[11]||(i[11]=n.createElementVNode("span",{class:"message-label"},"AI",-1)),n.createElementVNode("div",ir,[m.content.trim().startsWith("<audio")?(n.openBlock(),n.createElementBlock("audio",{key:0,ref_for:!0,ref_key:"audioRef",ref:R,src:E(m.content)??"",controls:"",autoplay:""},null,8,lr)):(n.openBlock(),n.createElementBlock("p",cr,n.toDisplayString(m.content),1))])],64)):m.role==="user"?(n.openBlock(),n.createElementBlock(n.Fragment,{key:1},[n.createElementVNode("div",ur,[n.createElementVNode("p",dr,n.toDisplayString(m.content),1)]),i[12]||(i[12]=n.createElementVNode("span",{class:"message-label"},"You",-1))],64)):n.createCommentVNode("",!0)],2)],2))),128)),n.unref(o)?(n.openBlock(),n.createElementBlock("div",fr,[n.createElementVNode("div",pr,[i[14]||(i[14]=n.createElementVNode("span",{class:"message-label"},"AI",-1)),n.createElementVNode("div",mr,[k.value?(n.openBlock(),n.createElementBlock("div",hr,i[13]||(i[13]=[n.createElementVNode("span",{class:"die"},"⚀",-1),n.createElementVNode("span",{class:"die"},"⚂",-1),n.createElementVNode("span",{class:"die"},"⚅",-1)]))):(n.openBlock(),n.createElementBlock("div",yr,"思考中..."))])])])):n.createCommentVNode("",!0)]),n.createElementVNode("form",{onSubmit:i[6]||(i[6]=n.withModifiers((...m)=>n.unref(l)&&n.unref(l)(...m),["prevent"])),class:"input-form"},[n.withDirectives(n.createElementVNode("textarea",{"onUpdate:modelValue":i[3]||(i[3]=m=>n.isRef(a)?a.value=m:null),placeholder:"请输入您的问题，或点击麦克风说话：",class:"chat-textarea",rows:"2",onKeydown:i[4]||(i[4]=n.withKeys(n.withModifiers((...m)=>n.unref(l)&&n.unref(l)(...m),["exact","prevent"]),["enter"]))},null,544),[[n.vModelText,n.unref(a)]]),n.createElementVNode("button",{type:"button",onClick:i[5]||(i[5]=m=>n.unref(h)?n.unref(u)():n.unref(p)()),class:n.normalizeClass(["mic-button",{"is-listening":n.unref(h)}]),title:"语音输入"}," 🎤 ",2),n.createElementVNode("button",{type:"submit",disabled:n.unref(o)},"发送",8,gr)],32)],4)):n.createCommentVNode("",!0),s.value&&d.value?(n.openBlock(),n.createElementBlock("div",{key:1,class:"draggable-modal",style:n.normalizeStyle({left:g.x+"px",top:g.y+"px"})},[n.createElementVNode("div",{class:"modal-header",onMousedown:i[8]||(i[8]=m=>b(g,m))},[i[15]||(i[15]=n.createElementVNode("span",null,"Debug Log",-1)),n.createElementVNode("button",{class:"close-btn",onClick:i[7]||(i[7]=m=>d.value=!1)},"✖")],32),n.createElementVNode("div",Er,[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(n.unref(r),m=>(n.openBlock(),n.createElementBlock("div",{key:m.id,class:"log-entry"},[n.createElementVNode("pre",null,n.toDisplayString(JSON.stringify(m,null,2)),1),i[16]||(i[16]=n.createElementVNode("hr",null,null,-1))]))),128))])],4)):n.createCommentVNode("",!0),s.value&&f.value?(n.openBlock(),n.createElementBlock("div",{key:2,class:"draggable-modal",style:n.normalizeStyle({left:y.x+"px",top:y.y+"px"})},[n.createElementVNode("div",{class:"modal-header",onMousedown:i[10]||(i[10]=m=>b(y,m))},[i[17]||(i[17]=n.createElementVNode("span",null,"备注",-1)),n.createElementVNode("button",{class:"close-btn",onClick:i[9]||(i[9]=m=>f.value=!1)},"✖")],32),i[18]||(i[18]=n.createElementVNode("div",{class:"modal-content pre-wrap text-center"},[n.createElementVNode("div",null,"中文语音库"),n.createElementVNode("div",null,"zf_xiaobei"),n.createElementVNode("div",null,"zf_xiaoni"),n.createElementVNode("div",null,"zf_xiaoxiao"),n.createElementVNode("div",null,"zf_xiaoyi"),n.createElementVNode("div",null,"zm_yunjian"),n.createElementVNode("div",null,"zm_yunxi"),n.createElementVNode("div",null,"zm_yunxia"),n.createElementVNode("div",null,"zm_yunyang")],-1))],4)):n.createCommentVNode("",!0)]))}}),_r=n.defineCustomElement(br);customElements.define("ai-chat-bubble",_r)});
